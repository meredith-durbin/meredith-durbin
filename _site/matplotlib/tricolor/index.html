<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Meredith J. Durbin"/>
    <meta name="description" content="Professional webpage"/>
    <link rel="icon" href="../../img/favicon.png">
    <title>Tri-color Images in Python | Meredith J. Durbin</title>
    <link href="../../css/bootstrap.css" rel="stylesheet">
    <link href="../../css/style.css" rel="stylesheet">
    <link href="../../css/pygments.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Raleway:400,200,700' rel='stylesheet' type='text/css'>
    <link href="../../font-awesome/css/font-awesome.css" rel="stylesheet">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>

      <nav class="navbar navbar-inverse navbar-fixed-top">
        <ul class="nav navbar-nav pull-left">
          	<li><a href="../"><i class="fa fa-fw fa-arrow-circle-left fa-lg"></i>&nbsp; Back</a></li>
        </ul>
    </nav>


    <div class="side-container" style="background-image:url('../../img/bg/hs-2012-01.jpg');">
      <section class="light">
        <div class="container">
		  <h3>How to Make a Tri-color Image in Python</h3>

<p>This tutorial is essentially an updated version of <a href="http://www.astrobetter.com/making-rgb-images-from-fits-files-with-pythonmatplotlib/">AstroBetter's</a> instructions, and uses code adapted from Min-Su Shin's <a href="http://www.astrobetter.com/wiki/tiki-index.php?page=RGB+Images+with+matplotlib">img_scale.py</a> script.</p>

<p>Also viewable as an <a href="ipynb/">iPython notebook</a>.</p>

<p>What we need to get started:</p>

<pre><span class="c"># setup notebook + import packages</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="c"># nothing below here is strictly necessary but I am picky about aesthetics</span>
<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format=&#39;retina&#39;
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rc</span>
<span class="n">rc</span><span class="p">(</span><span class="s">&#39;font&#39;</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s">&#39;family&#39;</span><span class="p">:</span> <span class="s">&#39;serif&#39;</span><span class="p">,</span> <span class="s">&#39;serif&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;Computer Modern Roman&#39;</span><span class="p">],</span> <span class="s">&#39;size&#39;</span><span class="p">:</span><span class="mi">14</span><span class="p">})</span>
<span class="n">rc</span><span class="p">(</span><span class="s">&#39;text&#39;</span><span class="p">,</span> <span class="n">usetex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>

<p>Now we open the three .fits files we want to work with. Mine are three Hubble WFC3/UVIS images from the Hubble Heritage <a href="http://heritage.stsci.edu/2015/01/index.html">Eagle Nebula</a> observing program in the filters F502N, F657N, and F673N.</p>

<pre><span class="c"># open your 3 fits images and load the image data to memory</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;fits_images/tricolor/F502N.fits&#39;</span><span class="p">)</span>
<span class="n">data_502</span> <span class="o">=</span> <span class="n">f1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">f1</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">f2</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;fits_images/tricolor/F657N.fits&#39;</span><span class="p">)</span>
<span class="n">data_657</span> <span class="o">=</span> <span class="n">f2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">f2</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">f3</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;fits_images/tricolor/F673N.fits&#39;</span><span class="p">)</span>
<span class="n">data_673</span> <span class="o">=</span> <span class="n">f3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">f3</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre>

<p>It's always a good idea to look at your images to figure out how best to scale their color values beforehand; this can also be done in DS9, but for example's sake I've done it in Matplotlib here; note the vmin and vmax arguments for each image.</p>

<pre><span class="c"># quickly set up figure + subplots</span>
<span class="c"># this way is easier than creating a separate figure object for each image</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="c"># remove annoying ticklabels</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">],</span> <span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="c"># display all images and adjust vmin and vmax manually</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_502</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&#39;Greys_r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;F502N&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_657</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&#39;Greys_r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;F657N&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_673</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">&#39;Greys_r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;F673N&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre>
<img class="main-med-center" src="filter_subplots.jpg">
<br>
<p>Now we need a function to normalize each image to the same scale (0 to 1). For more advanced options, including square root, log, and arsinh scales, check out <a href="http://www.astrobetter.com/wiki/tiki-index.php?page=RGB+Images+with+matplotlib">img_scale.py</a>.</p>

<pre><span class="c"># scale images so that all image values are from 0 to 1</span>
<span class="k">def</span> <span class="nf">scale_img</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">img_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c"># set min and max value if none provided in kwargs</span>
    <span class="k">if</span> <span class="n">vmin</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">imageData</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">vmax</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">imageData</span><span class="p">)</span>
    <span class="c"># subtract minimum value from data</span>
    <span class="n">img_data</span> <span class="o">-=</span> <span class="n">vmin</span>
    <span class="c"># establish scale factor/new maximum value</span>
    <span class="n">img_range</span> <span class="o">=</span> <span class="n">vmax</span> <span class="o">-</span> <span class="n">vmin</span>
    <span class="c"># set all negative values to 0 and values above max to 1</span>
    <span class="n">img_data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">img_data</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">img_data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">img_data</span> <span class="o">&gt;</span> <span class="n">img_range</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.</span> 
    <span class="c"># select values within range and normalize to scale factor</span>
    <span class="n">middle_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">img_data</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">img_data</span> <span class="o">&lt;=</span> <span class="n">img_range</span><span class="p">))</span>
    <span class="n">img_data</span><span class="p">[</span><span class="n">middle_values</span><span class="p">]</span> <span class="o">/=</span> <span class="n">img_range</span> 
    <span class="k">return</span> <span class="n">img_data</span>
</pre>

<p>We can now scale each image and combine them into one three-dimensional array, where the third dimension is RGB color:</p>

<pre><span class="c"># make individual color images</span>
<span class="n">blue</span> <span class="o">=</span> <span class="n">scale_img</span><span class="p">(</span><span class="n">data_502</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">green</span> <span class="o">=</span> <span class="n">scale_img</span><span class="p">(</span><span class="n">data_657</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">red</span> <span class="o">=</span> <span class="n">scale_img</span><span class="p">(</span><span class="n">data_673</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

<span class="c"># put together individual images to make tricolor image</span>
<span class="n">colorimage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">red</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">green</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">blue</span><span class="o">.</span><span class="n">T</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="c"># check that array dimensions are correct; last one must be 3</span>
<span class="k">print</span> <span class="n">colorimage</span><span class="o">.</span><span class="n">shape</span>
</pre>

<tt>(4660, 4254, 3)</tt>
<br><br>
<p>Let's look at the results!</p>

<pre><span class="c"># create figure object and set size to 7x7 inches</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="c"># display the image; no keyword arguments are necessary this time</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">colorimage</span><span class="p">)</span>
<span class="c"># different way of removing ticks</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
</pre>

<img class="main-lg-center" src="tricolor.jpg">

</div>
        </section>
        <div class="push"></div>
      </div>
    <footer>
      <div class="container">
        &copy; 2014 Meredith Durbin
      </div>
    </footer>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script src="../../js/bootstrap.js"></script>
  </body>
</html>
